var Ot=Object.defineProperty;var Gt=(r,t,e)=>t in r?Ot(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var f=(r,t,e)=>Gt(r,typeof t!="symbol"?t+"":t,e);const K={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},wt={};for(const r in K)wt[K[r]]=Number(r);const Rt=Object.freeze(Object.defineProperty({__proto__:null,tagsById:K,tagsByName:wt},Symbol.toStringTag,{value:"Module"})),tt={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},Pt={};for(const r in tt)Pt[tt[r]]=Number(r);const Nt=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tt,tagsByName:Pt},Symbol.toStringTag,{value:"Module"})),et={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},vt={};for(const r in et)vt[et[r]]=Number(r);const Wt=Object.freeze(Object.defineProperty({__proto__:null,tagsById:et,tagsByName:vt},Symbol.toStringTag,{value:"Module"}));function xt(r,t="utf8"){return new TextDecoder(t).decode(r)}const Vt=new TextEncoder;function zt(r){return Vt.encode(r)}const Ht=1024*8,$t=(()=>{const r=new Uint8Array(4),t=new Uint32Array(r.buffer);return!((t[0]=1)&r[0])})(),q={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Y{constructor(t=Ht,e={}){f(this,"buffer");f(this,"byteLength");f(this,"byteOffset");f(this,"length");f(this,"offset");f(this,"lastWrittenByte");f(this,"littleEndian");f(this,"_data");f(this,"_mark");f(this,"_marks");let i=!1;typeof t=="number"?t=new ArrayBuffer(t):(i=!0,this.lastWrittenByte=t.byteLength);const n=e.offset?e.offset>>>0:0,a=t.byteLength-n;let s=n;(ArrayBuffer.isView(t)||t instanceof Y)&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+n),t=t.buffer),i?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,a),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const i=(this.offset+t)*2,n=new Uint8Array(i);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const i=q[e].BYTES_PER_ELEMENT*t,n=this.byteOffset+this.offset,a=this.buffer.slice(n,n+i);if(this.littleEndian===$t&&e!=="uint8"&&e!=="int8"){const h=new Uint8Array(this.buffer.slice(n,n+i));h.reverse();const c=new q[e](h.buffer);return this.offset+=i,c.reverse(),c}const s=new q[e](a);return this.offset+=i,s}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let i=0;i<t;i++)e+=this.readChar();return e}readUtf8(t=1){return xt(this.readBytes(t))}decodeText(t=1,e="utf8"){return xt(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(zt(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Yt(r){if(r.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=r.rowsPerStrip*r.width*r.samplesPerPixel*(r.bitsPerSample/8);return new Array(r.stripOffsets.length).fill(t)}function jt(r,t,e){let i=0;for(;i<r.length;){for(let n=e;n<t*e;n+=e)for(let a=0;a<e;a++)r[i+n+a]=r[i+n+a]+r[i+n-(e-a)]&255;i+=t*e}}function Jt(r,t,e){let i=0;for(;i<r.length;){for(let n=e;n<t*e;n+=e)for(let a=0;a<e;a++)r[i+n+a]=r[i+n+a]+r[i+n-(e-a)]&65535;i+=t*e}}const gt={standard:Wt,exif:Rt,gps:Nt};class It{constructor(t){f(this,"kind");f(this,"data");f(this,"fields");f(this,"exif");f(this,"gps");f(this,"_hasMap");f(this,"_map");if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(gt[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=gt[this.kind].tagsById;for(const e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}const Bt=new Map([[1,[1,dt]],[2,[1,Zt]],[3,[2,Qt]],[4,[4,Kt]],[5,[8,te]],[6,[1,ee]],[7,[1,dt]],[8,[2,re]],[9,[4,ie]],[10,[8,ne]],[11,[4,ae]],[12,[8,se]]]);function Xt(r,t){const e=Bt.get(r);if(!e)throw new Error(`type not found: ${r}`);return e[0]*t}function qt(r,t,e){const i=Bt.get(t);if(!i)throw new Error(`type not found: ${t}`);return i[1](r,e)}function dt(r,t){if(t===1)return r.readUint8();const e=new Uint8Array(t);for(let i=0;i<t;i++)e[i]=r.readUint8();return e}function Zt(r,t){const e=[];let i="";for(let n=0;n<t;n++){const a=String.fromCharCode(r.readUint8());a==="\0"?(e.push(i),i=""):i+=a}return e.length===1?e[0]:e}function Qt(r,t){if(t===1)return r.readUint16();const e=new Uint16Array(t);for(let i=0;i<t;i++)e[i]=r.readUint16();return e}function Kt(r,t){if(t===1)return r.readUint32();const e=new Uint32Array(t);for(let i=0;i<t;i++)e[i]=r.readUint32();return e}function te(r,t){if(t===1)return r.readUint32()/r.readUint32();const e=new Array(t);for(let i=0;i<t;i++)e[i]=r.readUint32()/r.readUint32();return e}function ee(r,t){if(t===1)return r.readInt8();const e=new Int8Array(t);for(let i=0;i<t;i++)e[i]=r.readInt8();return e}function re(r,t){if(t===1)return r.readInt16();const e=new Int16Array(t);for(let i=0;i<t;i++)e[i]=r.readInt16();return e}function ie(r,t){if(t===1)return r.readInt32();const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=r.readInt32();return e}function ne(r,t){if(t===1)return r.readInt32()/r.readInt32();const e=new Array(t);for(let i=0;i<t;i++)e[i]=r.readInt32()/r.readInt32();return e}function ae(r,t){if(t===1)return r.readFloat32();const e=new Float32Array(t);for(let i=0;i<t;i++)e[i]=r.readFloat32();return e}function se(r,t){if(t===1)return r.readFloat64();const e=new Float64Array(t);for(let i=0;i<t;i++)e[i]=r.readFloat64();return e}const oe=256,pt=257,mt=258,yt=9;let _=[];function le(){if(_.length===0){for(let t=0;t<256;t++)_.push([t]);const r=[];for(let t=256;t<4096;t++)_.push(r)}}const he=[511,1023,2047,4095],fe=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class ue{constructor(t){f(this,"stripArray");f(this,"nextData",0);f(this,"nextBits",0);f(this,"bytePointer",0);f(this,"tableLength",mt);f(this,"currentBitLength",yt);f(this,"outData");this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new Y(t.byteLength),this.initializeTable()}decode(){let t=0,e=0;for(;(t=this.getNextCode())!==pt;)if(t===oe){if(this.initializeTable(),t=this.getNextCode(),t===pt)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const n=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(n),this.addStringToTable(n),e=t}const i=this.outData.toArray();return new DataView(i.buffer,i.byteOffset,i.byteLength)}initializeTable(){le(),this.tableLength=mt,this.currentBitLength=yt}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return _[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(_[this.tableLength++]=t,_.length>4096)throw _=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===fe[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&he[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function ce(r){return new ue(r).decode()}const xe=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class bt extends It{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){const t=new Date,e=xe.exec(this.dateTime);if(e===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return R(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return R(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")||2**32-1}get stripByteCounts(){return R(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||2**this.bitsPerSample-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return R(this.get("SampleFormat")||1)[0]}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const i=[];for(let n=0;n<t;n++)i.push([e[n],e[n+t],e[n+2*t]]);return i}get tileWidth(){return this.get("TileWidth")}get tileHeight(){return this.get("TileLength")}get tileOffsets(){return R(this.get("TileOffsets"))}get tileByteCounts(){return R(this.get("TileByteCounts"))}get tiled(){return this.tileWidth!==void 0&&this.tileHeight!==void 0&&this.tileOffsets!==void 0&&this.tileByteCounts!==void 0}}function R(r){return typeof r=="number"?[r]:r}var w=Uint8Array,N=Uint16Array,ge=Int32Array,Dt=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ct=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),de=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),At=function(r,t){for(var e=new N(31),i=0;i<31;++i)e[i]=t+=1<<r[i-1];for(var n=new ge(e[30]),i=1;i<30;++i)for(var a=e[i];a<e[i+1];++a)n[a]=a-e[i]<<5|i;return{b:e,r:n}},Tt=At(Dt,2),Ft=Tt.b,pe=Tt.r;Ft[28]=258,pe[258]=28;var me=At(Ct,0),ye=me.b,rt=new N(32768);for(var u=0;u<32768;++u){var L=(u&43690)>>1|(u&21845)<<1;L=(L&52428)>>2|(L&13107)<<2,L=(L&61680)>>4|(L&3855)<<4,rt[u]=((L&65280)>>8|(L&255)<<8)>>1}var V=(function(r,t,e){for(var i=r.length,n=0,a=new N(t);n<i;++n)r[n]&&++a[r[n]-1];var s=new N(t);for(n=1;n<t;++n)s[n]=s[n-1]+a[n-1]<<1;var h;if(e){h=new N(1<<t);var c=15-t;for(n=0;n<i;++n)if(r[n])for(var p=n<<4|r[n],x=t-r[n],o=s[r[n]-1]++<<x,l=o|(1<<x)-1;o<=l;++o)h[rt[o]>>c]=p}else for(h=new N(i),n=0;n<i;++n)r[n]&&(h[n]=rt[s[r[n]-1]++]>>15-r[n]);return h}),z=new w(288);for(var u=0;u<144;++u)z[u]=8;for(var u=144;u<256;++u)z[u]=9;for(var u=256;u<280;++u)z[u]=7;for(var u=280;u<288;++u)z[u]=8;var Lt=new w(32);for(var u=0;u<32;++u)Lt[u]=5;var be=V(z,9,1),Se=V(Lt,5,1),Z=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},C=function(r,t,e){var i=t/8|0;return(r[i]|r[i+1]<<8)>>(t&7)&e},Q=function(r,t){var e=t/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(t&7)},we=function(r){return(r+7)/8|0},Pe=function(r,t,e){return(e==null||e>r.length)&&(e=r.length),new w(r.subarray(t,e))},ve=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(r,t,e){var i=new Error(t||ve[r]);if(i.code=r,Error.captureStackTrace&&Error.captureStackTrace(i,S),!e)throw i;return i},it=function(r,t,e,i){var n=r.length,a=0;if(!n||t.f&&!t.l)return e||new w(0);var s=!e,h=s||t.i!=2,c=t.i;s&&(e=new w(n*3));var p=function(ft){var ut=e.length;if(ft>ut){var ct=new w(Math.max(ut*2,ft));ct.set(e),e=ct}},x=t.f||0,o=t.p||0,l=t.b||0,g=t.l,P=t.d,y=t.m,m=t.n,I=n*8;do{if(!g){x=C(r,o,1);var E=C(r,o+1,3);if(o+=3,E)if(E==1)g=be,P=Se,y=9,m=5;else if(E==2){var v=C(r,o,31)+257,M=C(r,o+10,15)+4,k=v+C(r,o+5,31)+1;o+=14;for(var A=new w(k),U=new w(19),d=0;d<M;++d)U[de[d]]=C(r,o+d*3,7);o+=M*3;for(var nt=Z(U),Et=(1<<nt)-1,Mt=V(U,nt,1),d=0;d<k;){var at=Mt[C(r,o,Et)];o+=at&15;var b=at>>4;if(b<16)A[d++]=b;else{var O=0,H=0;for(b==16?(H=3+C(r,o,3),o+=2,O=A[d-1]):b==17?(H=3+C(r,o,7),o+=3):b==18&&(H=11+C(r,o,127),o+=7);H--;)A[d++]=O}}var st=A.subarray(0,v),F=A.subarray(v);y=Z(st),m=Z(F),g=V(st,y,1),P=V(F,m,1)}else S(1);else{var b=we(o)+4,B=r[b-4]|r[b-3]<<8,D=b+B;if(D>n){c&&S(0);break}h&&p(l+B),e.set(r.subarray(b,D),l),t.b=l+=B,t.p=o=D*8,t.f=x;continue}if(o>I){c&&S(0);break}}h&&p(l+131072);for(var Ut=(1<<y)-1,_t=(1<<m)-1,j=o;;j=o){var O=g[Q(r,o)&Ut],G=O>>4;if(o+=O&15,o>I){c&&S(0);break}if(O||S(2),G<256)e[l++]=G;else if(G==256){j=o,g=null;break}else{var ot=G-254;if(G>264){var d=G-257,W=Dt[d];ot=C(r,o,(1<<W)-1)+Ft[d],o+=W}var J=P[Q(r,o)&_t],X=J>>4;J||S(3),o+=J&15;var F=ye[X];if(X>3){var W=Ct[X];F+=Q(r,o)&(1<<W)-1,o+=W}if(o>I){c&&S(0);break}h&&p(l+131072);var lt=l+ot;if(l<F){var ht=a-F,kt=Math.min(F,lt);for(ht+l<0&&S(3);l<kt;++l)e[l]=i[ht+l]}for(;l<lt;++l)e[l]=e[l-F]}}t.l=g,t.p=j,t.b=l,t.f=x,g&&(x=1,t.m=y,t.d=P,t.n=m)}while(!x);return l!=e.length&&s?Pe(e,0,l):e.subarray(0,l)},Ie=new w(0),Be=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&S(6,"invalid gzip data");var t=r[3],e=10;t&4&&(e+=(r[10]|r[11]<<8)+2);for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!r[e++]);return e+(t&2)},De=function(r){var t=r.length;return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0},Ce=function(r,t){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&S(6,"invalid zlib data"),(r[1]>>5&1)==1&&S(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Ae(r,t){return it(r,{i:2},t,t)}function Te(r,t){var e=Be(r);return e+8>r.length&&S(6,"invalid gzip data"),it(r.subarray(e,-8),{i:2},new w(De(r)),t)}function Fe(r,t){return it(r.subarray(Ce(r),-4),{i:2},t,t)}function Le(r,t){return r[0]==31&&r[1]==139&&r[2]==8?Te(r,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Ae(r,t):Fe(r,t)}var Ee=typeof TextDecoder<"u"&&new TextDecoder,Me=0;try{Ee.decode(Ie,{stream:!0}),Me=1}catch{}function Ue(r){const t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),e=Le(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}const _e={ignoreImageData:!1};class $ extends Y{constructor(e){super(e);f(this,"_nextIFD");this._nextIFD=0}get isMultiPage(){let e=0;for(this.decodeHeader();this._nextIFD;)if(e++,this.decodeIFD({ignoreImageData:!0},!0),e===2)return!0;if(e===1)return!1;throw T("ifdCount",e)}get pageCount(){let e=0;for(this.decodeHeader();this._nextIFD;)e++,this.decodeIFD({ignoreImageData:!0},!0);if(e>0)return e;throw T("ifdCount",e)}decode(e={}){const{pages:i}=e;ke(i);const n=i?Math.max(...i):1/0;e={..._e,...e};const a=[];this.decodeHeader();let s=0;for(;this._nextIFD;){if(i){if(i.includes(s)?a.push(this.decodeIFD(e,!0)):this.decodeIFD({ignoreImageData:!0},!0),s===n)break}else a.push(this.decodeIFD(e,!0));s++}if(s<n&&n!==1/0)throw new RangeError(`Index ${n} is out of bounds. The stack only contains ${s} images.`);return a}decodeHeader(){const e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${e.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e,i){this.seek(this._nextIFD);let n;if(i)n=new bt;else{if(!e.kind)throw new Error("kind is missing");n=new It(e.kind)}const a=this.readUint16();for(let s=0;s<a;s++)this.decodeIFDEntry(n);if(!e.ignoreImageData){if(!(n instanceof bt))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(e){const i=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}Xt(a,s)>4&&this.seek(this.readUint32());const c=qt(this,a,s);if(e.fields.set(n,c),n===34665||n===34853){const p=this.offset;let x="exif";n===34665?x="exif":n===34853&&(x="gps"),this._nextIFD=c,e[x]=this.decodeIFD({kind:x,ignoreImageData:!0},!1),this.offset=p}this.seek(i),this.skip(12)}decodeImageData(e){const i=e.orientation;if(i&&i!==1)throw T("orientation",i);switch(e.type){case 0:case 1:case 2:case 3:e.tiled?this.readTileData(e):this.readStripData(e);break;default:throw T("image type",e.type)}if(this.applyPredictor(e),this.convertAlpha(e),e.bitsPerSample===1&&this.split1BitData(e),e.type===0){const a=2**e.bitsPerSample-1;for(let s=0;s<e.data.length;s++)e.data[s]=a-e.data[s]}}split1BitData(e){const{imageWidth:i,imageLength:n,samplesPerPixel:a}=e,s=new Uint8Array(n*i*a),h=Math.ceil(i*a/8);let c=0;for(let p=0;p<n;p++){const x=p*h;for(let o=0;o<i*a;o++){const l=x+Math.floor(o/8),g=7-o%8,P=e.data[l]>>g&1;s[c++]=P}}e.data=s}static uncompress(e,i=1){switch(i){case 1:return e;case 5:return ce(e);case 8:case 32946:return Ue(e);case 2:throw T("Compression","CCITT Group 3");case 32773:throw T("Compression","PackBits");default:throw T("Compression",i)}}createSampleReader(e,i,n){if(i===8||i===1)return(a,s)=>a.getUint8(s);if(i===16)return(a,s)=>a.getUint16(2*s,n);if(i===32&&e===3)return(a,s)=>a.getFloat32(4*s,n);if(i===64&&e===3)return(a,s)=>a.getFloat64(8*s,n);throw T("bitDepth",i)}readStripData(e){const i=e.width,n=e.height,a=e.bitsPerSample!==1?i*e.samplesPerPixel*n:Math.ceil(i*e.samplesPerPixel/8)*n,s=e.stripOffsets,h=e.stripByteCounts||Yt(e),c=this.isLittleEndian(),p=e.bitsPerSample!==1?i*e.samplesPerPixel*e.rowsPerStrip:Math.ceil(i*e.samplesPerPixel/8)*e.rowsPerStrip,x=this.createSampleReader(e.sampleFormat,e.bitsPerSample,c),o=St(a,e.bitsPerSample,e.sampleFormat);let l=0;for(let g=0;g<s.length;g++){const P=new DataView(this.buffer,this.byteOffset+s[g],h[g]),y=$.uncompress(P,e.compression),m=Math.min(p,a-l);for(let I=0;I<m;++I){const E=x(y,I);o[l+I]=E}l+=m}e.data=o}readTileData(e){if(!e.tileWidth||!e.tileHeight)return;const i=e.width,n=e.height,a=e.bitsPerSample!==1?i*n*e.samplesPerPixel:Math.ceil(i*e.samplesPerPixel/8)*n,s=e.tileWidth,h=e.tileHeight,c=Math.ceil(i/s),p=Math.ceil(n/h),x=e.tileOffsets,o=e.tileByteCounts,l=this.isLittleEndian(),g=this.createSampleReader(e.sampleFormat,e.bitsPerSample,l),P=St(a,e.bitsPerSample,e.sampleFormat);for(let y=0;y<c;++y)for(let m=0;m<p;++m){const I=m*c+y,E=new DataView(this.buffer,this.byteOffset+x[I],o[I]),b=$.uncompress(E,e.compression);if(e.bitsPerSample===1){const B=Math.ceil(i/8),D=Math.ceil(s/8);for(let v=0;v<h&&m*h+v<n;v++){const M=m*h+v,k=v*D,A=M*B+Math.floor(y*s/8),U=Math.min(D,B-Math.floor(y*s/8));for(let d=0;d<U;d++)P[A+d]=g(b,k+d)}}else for(let B=0;B<h;B++)for(let D=0;D<s;D++){const v=y*s+D,M=m*h+B;if(v>=i||M>=n)continue;const k=B*s+D,A=g(b,k),U=(M*i+v)*e.samplesPerPixel;P[U]=A}}e.data=P}applyPredictor(e){const i=e.bitsPerSample;switch(e.predictor){case 1:break;case 2:{if(i===8)jt(e.data,e.width,e.components);else if(i===16)Jt(e.data,e.width,e.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${i}`);break}default:throw new Error(`invalid predictor: ${e.predictor}`)}}convertAlpha(e){if(e.alpha&&e.associatedAlpha){const{data:i,components:n,maxSampleValue:a}=e;for(let s=0;s<i.length;s+=n){const h=i[s+n-1];for(let c=0;c<n-1;c++)i[s+c]=Math.round(i[s+c]*a/h)}}}}function St(r,t,e){if(t===8||t===1)return new Uint8Array(r);if(t===16)return new Uint16Array(r);if(t===32&&e===3)return new Float32Array(r);if(t===64&&e===3)return new Float64Array(r);throw T("bit depth / sample format",`${t} / ${e}`)}function T(r,t){return new Error(`Unsupported ${r}: ${t}`)}function ke(r){if(r){for(const t of r)if(t<0||!Number.isInteger(t))throw new RangeError(`Index ${t} is invalid. Must be a positive integer.`)}}function Ge(r,t){return new $(r).decode(t)}export{Ge as d};
