import{r as b,c as q,a as g,b as t,w as P,v as V,d as y,e as N,t as w,n as J,f as K,u as Q,o as p}from"./index-BBJq7pGA.js";import{d as X}from"./index-UcaH2mKL.js";const Y={class:"flex flex-col h-screen w-screen text-white inset-0 m-0 p-0 overflow-hidden bg-cover bg-center"},Z={class:"flex flex-1 p-4 gap-4"},ee={class:"w-80 max-w-[28rem] flex-shrink-0 rounded-lg border border-gray-200 bg-gray-100 p-4 text-slate-900"},te={class:"space-y-4"},le={class:"mt-6 pt-10"},ae={key:0,class:"mt-4 space-y-2"},se={class:"font-mono"},ne={class:"font-mono"},re={class:"flex flex-col gap-2 pt-2"},oe=["href"],ie=["href"],ue=["href"],de={class:"pt-10"},ce=["disabled"],fe={key:0,class:"mt-3 text-red-600 text-sm"},ve={class:"mt-6 border-t border-gray-300 pt-4"},ge={class:"flex justify-between text-xs text-gray-500 mt-1"},pe={class:"flex-1 rounded-lg border border-gray-200 bg-gray-100 overflow-hidden grid place-items-center relative"},me=["src"],be={key:1,class:"flex-1 flex items-center justify-center text-gray-400"},ye={__name:"Bhwytj",setup(xe){const z=Q(),h=b(null),F=b(10),k=b(500),n=b("idle"),s=b({id:"",value:null,calculated_tif_url:"",reprojected_tif_url:"",input_tif_url:""}),m=b(""),_=b(""),D="http://localhost:25376/",I=D.endsWith("/")?D:`${D}/`,A=q(()=>n.value==="running"?"æ­£åœ¨è®¡ç®—":n.value==="done"?"é‡æ–°è®¡ç®—":"å¼€å§‹è®¡ç®—"),T=l=>l?/^https?:\/\//i.test(l)?l:l.startsWith("/")?I+l.slice(1):I+l:"",H=async l=>{try{const e=await l.arrayBuffer(),a=X(e);if(!a||a.length===0)return"";const r=a[0],{width:o,height:c,data:i}=r,B=o*c,C=i.length/B,j=document.createElement("canvas");j.width=o,j.height=c;const E=j.getContext("2d"),L=E.createImageData(o,c),f=L.data;if(C===1){let d=1/0,v=-1/0;for(let u=0;u<i.length;u++)i[u]<d&&(d=i[u]),i[u]>v&&(v=i[u]);const x=v-d||1;for(let u=0;u<B;u++){const O=i[u],M=Math.floor((O-d)/x*255),S=u*4;f[S]=M,f[S+1]=M,f[S+2]=M,f[S+3]=255}}else if(C>=3)for(let d=0;d<B;d++){const v=d*C,x=d*4;f[x]=i[v],f[x+1]=i[v+1],f[x+2]=i[v+2],f[x+3]=C>3?i[v+3]:255}return E.putImageData(L,0,0),j.toDataURL("image/png")}catch(e){return console.error("TIFF render error:",e),""}},R=async()=>{if(!h.value){_.value="è¯·å…ˆé€‰æ‹© DEM æ–‡ä»¶";return}_.value="",n.value="running";try{const l=new FormData;l.append("file",h.value),l.append("max_iter",String(Math.max(1,Number(F.value||1))));const e=I+"process-slbl",a=await fetch(e,{method:"POST",body:l});if(!a.ok)throw new Error(`è¯·æ±‚å¤±è´¥ï¼š${a.status}`);const r=await a.json();if(s.value={id:r.id??"",value:r.volume_diff_m3??null,calculated_tif_url:T(r.calculated_tif_url),reprojected_tif_url:T(r.reprojected_tif_url),input_tif_url:T(r.input_tif_url)},s.value.calculated_tif_url)try{const o=await fetch(s.value.calculated_tif_url);if(o.ok){const c=await o.blob();m.value=await H(c)}else m.value=U(s.value.value||0)}catch(o){console.warn("Failed to fetch/render TIFF:",o),m.value=U(s.value.value||0)}else m.value=U(s.value.value||0);n.value="done"}catch(l){_.value=String((l==null?void 0:l.message)||"æœªçŸ¥é”™è¯¯"),n.value="idle"}},W=()=>{n.value==="idle"?R():n.value==="done"&&(n.value="idle",s.value={id:"",value:null,calculated_tif_url:"",reprojected_tif_url:"",input_tif_url:""},m.value="",R())},$=l=>{var e;h.value=((e=l.target.files)==null?void 0:e[0])??null},G=()=>{z.push({name:"home"})},U=l=>{const e=document.createElement("canvas");e.width=640,e.height=360;const a=e.getContext("2d"),r=a.createLinearGradient(0,0,e.width,e.height);r.addColorStop(0,"#7c2d12"),r.addColorStop(1,"#fdba74"),a.fillStyle=r,a.fillRect(0,0,e.width,e.height);const o=60,c=Math.min(300,Math.max(20,(l||0)/500));return a.fillStyle="#9a3412",a.fillRect(e.width/2-o/2,e.height-c-20,o,c),e.toDataURL("image/png")};return(l,e)=>(p(),g("div",Y,[t("header",{class:"flex items-center px-5"},[t("button",{onClick:G,class:"mr-4 bg-gray-100 text-slate-900 hover:bg-gray-300 h-full grid place-items-center rounded-l-lg","aria-label":"è¿”å›ä¸»é¡µ"},[...e[2]||(e[2]=[t("div",{class:"px-4 text-2xl"},"è¿”å›",-1)])]),e[3]||(e[3]=t("div",{class:"flex-1 text-center bg-gray-100 text-black py-6 px-10 rounded-r-lg text-3xl font-bold tracking-wide select-none"}," å´©æ»‘ç‰©æºä½“ç§¯ ",-1))]),t("div",Z,[t("aside",ee,[e[12]||(e[12]=t("div",{class:"mb-3 text-lg font-bold text-slate-700 pb-4"},"è¾“å…¥æ–‡ä»¶",-1)),t("div",te,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm mb-2 text-slate-700"},"DEM",-1)),t("input",{type:"file",accept:".tif,.dem,.asc",class:"block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:bg-blue-600 file:text-white hover:file:bg-blue-700",onChange:$},null,32)]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm mb-2 text-slate-700"},"è¿­ä»£æ¬¡æ•°",-1)),P(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>F.value=a),type:"number",min:"1",placeholder:"ä¾‹å¦‚ï¼š10",class:"w-full px-3 py-2 rounded-md bg-gray-100 border border-gray-300 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[V,F.value,void 0,{number:!0}]])])]),t("div",le,[e[8]||(e[8]=t("div",{class:"mb-3 text-lg font-bold text-slate-700 py-4"},"è¾“å‡ºæ–‡ä»¶",-1)),n.value==="done"?(p(),g("div",ae,[t("div",null,[e[6]||(e[6]=N("IDï¼š",-1)),t("span",se,w(s.value.id),1)]),t("div",null,[e[7]||(e[7]=N("ä½“ç§¯å·®ï¼ˆmÂ³ï¼‰ï¼š",-1)),t("span",ne,w(s.value.value),1)]),t("div",re,[s.value.calculated_tif_url?(p(),g("a",{key:0,href:s.value.calculated_tif_url,class:"inline-block px-3 py-2 rounded-md bg-green-600 text-white hover:bg-green-700"},"ä¸‹è½½è®¡ç®—å SLBL tif",8,oe)):y("",!0),s.value.reprojected_tif_url?(p(),g("a",{key:1,href:s.value.reprojected_tif_url,class:"inline-block px-3 py-2 rounded-md bg-green-600 text-white hover:bg-green-700"},"ä¸‹è½½é‡æŠ•å½±ç»“æœ tif",8,ie)):y("",!0),s.value.input_tif_url?(p(),g("a",{key:2,href:s.value.input_tif_url,class:"inline-block px-3 py-2 rounded-md bg-green-600 text-white hover:bg-green-700"},"ä¸‹è½½åŸå§‹ä¸Šä¼  tif",8,ue)):y("",!0)])])):y("",!0)]),t("div",de,[t("button",{class:J(["w-full py-2 rounded-md transition",n.value==="running"||!h.value?"bg-gray-400 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 active:scale-[.99]"]),disabled:n.value==="running"||!h.value,onClick:W},w(A.value),11,ce),_.value?(p(),g("div",fe,w(_.value),1)):y("",!0)]),t("div",ve,[e[11]||(e[11]=t("label",{class:"block text-sm font-bold text-slate-700 mb-2"},"å›¾ç‰‡é«˜åº¦æ§åˆ¶",-1)),P(t("input",{type:"range",min:"100",max:"1200","onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),class:"range range-primary range-sm w-full"},null,512),[[V,k.value]]),t("div",ge,[e[9]||(e[9]=t("span",null,"å°",-1)),t("span",null,w(k.value)+"px",1),e[10]||(e[10]=t("span",null,"å¤§",-1))])])]),t("main",pe,[m.value?(p(),g("img",{key:0,src:m.value,style:K({height:k.value+"px"}),class:"object-contain max-w-full transition-all duration-200"},null,12,me)):(p(),g("div",be,[...e[13]||(e[13]=[t("div",{class:"text-center"},[t("div",{class:"text-4xl mb-2"},"ğŸ“Š"),t("div",null,"ç»“æœé¢„è§ˆåŒºåŸŸ")],-1)])]))])])]))}};export{ye as default};
